{% extends 'base.html' %}

{% block page_icon %}user{% endblock %}
{% block page_title %}User Details{% endblock %}

{% block content %}
<div class="row">
    <div class="col-lg-4">
        <div class="table-card mb-4">
            <div class="text-center mb-4">
                <div class="bg-primary text-white rounded-circle d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px; font-size: 32px;">
                    {{ user_obj.username|slice:":1"|upper }}
                </div>
                <h4>{{ user_obj.username }}</h4>
                <p class="text-muted">{{ user_obj.email }}</p>
                {% if user_obj.is_superuser %}
                <span class="badge bg-danger">Superuser</span>
                {% endif %}
                {% if user_obj.is_active %}
                <span class="badge bg-success">Active</span>
                {% else %}
                <span class="badge bg-danger">Inactive</span>
                {% endif %}
            </div>
            
            <table class="table table-borderless">
                <tr><th>First Name</th><td>{{ user_obj.first_name|default:"-" }}</td></tr>
                <tr><th>Last Name</th><td>{{ user_obj.last_name|default:"-" }}</td></tr>
                <tr><th>Joined</th><td>{{ user_obj.date_joined|date:"M d, Y" }}</td></tr>
                <tr><th>Last Login</th><td>{{ user_obj.last_login|date:"M d, Y H:i"|default:"Never" }}</td></tr>
            </table>
            
            <hr>
            
            <h6>Change Role</h6>
            <form method="post" action="{% url 'assets:user_change_role' user_obj.pk %}">
                {% csrf_token %}
                <div class="input-group">
                    <select name="group_id" class="form-select">
                        <option value="">No Role</option>
                        {% for g in groups %}
                        <option value="{{ g.id }}" {% if g in user_obj.groups.all %}selected{% endif %}>{{ g.name }}</option>
                        {% endfor %}
                    </select>
                    <button class="btn btn-primary" type="submit">Save</button>
                </div>
            </form>
        </div>
    </div>
    
    <div class="col-lg-8">
        <div class="table-card">
            <h5 class="mb-4"><i class="fas fa-history me-2"></i>User Activity</h5>
            <div class="table-responsive">
                <table class="table">
                    <thead>
                        <tr><th>Date</th><th>Asset</th><th>Action</th><th>Description</th></tr>
                    </thead>
                    <tbody>
                        {% for a in activity %}
                        <tr>
                            <td>{{ a.created_at|date:"M d, Y H:i" }}</td>
                            <td><a href="{% url 'assets:asset_detail' a.asset.pk %}">{{ a.asset.asset_tag }}</a></td>
                            <td><span class="badge bg-info">{{ a.get_action_display }}</span></td>
                            <td>{{ a.description|truncatewords:10 }}</td>
                        </tr>
                        {% empty %}
                        <tr><td colspan="4" class="text-center text-muted">No activity</td></tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}
